# Checando Work Diretory
getwd()

# Instalando e carregando pacotes

# install.packages("PNADcIBGE")
# install.packages("stringr")
# install.packages("tidyverse")

library(tidyverse)
library(ggplot2)
library(PNADcIBGE)
library(stringr)


# Baixando os dados da PNAD Cont√≠nua para o ano de 2019, terceiro trimestre
# A fun√ß√£o get_pnadc() √© utilizada para baixar os dados com as vari√°veis de interesse.
df_pnad <- get_pnadc(year = 2019, quarter = 3,
                     vars = c(
                       "VD4020", # Rendimento mensal efetivo
                       "VD4031", # Horas habitualmente trabalhadas
                       "UF", # Unidade da federa√ß√£o
                       "V1022", # Situa√ß√£o do Domic√≠lio (Rural/Urbano)
                       "V2007", # Sexo
                       "V2009", # Idade
                       "V2010", # Cor ou ra√ßa
                       "V3009A", # Curso mais elevado que frequentou
                       "VD3005", # Anos de estudo
                       "VD4001", # Condi√ß√£o em rela√ß√£o √† For√ßa de Trabalho
                       "VD4002", # Condi√ß√£o do ocupa√ß√£o
                       "VD4009" # Setor
                     ), design = FALSE) ## Definindo design como FALSE para n√£o carregar o pacote de survey (opcional nesse caso)

# Selecionando apenas as colunas de interesse que foram baixadas para assegurar que as vari√°veis s√£o mantidas
df_pnad <- df_pnad[,c(
  "VD4020", # Rendimento mensal efetivo
  "VD4031", # Horas habitualmente trabalhadas
  "UF", # Unidade da federa√ß√£o
  "V1022", # Situa√ß√£o do Domic√≠lio (Rural/Urbano)
  "V2007", # Sexo
  "V2009", # Idade
  "V2010", # Cor ou ra√ßa
  "V3009A", # Curso mais elevado que frequentou
  "VD3005", # Anos de estudo
  "VD4001", # Condi√ß√£o em rela√ß√£o √† For√ßa de Trabalho
  "VD4002", # Condi√ß√£o do ocupa√ß√£o
  "VD4009" # Setor
)]

# Gerando uma tabela para examinar as categorias da vari√°vel 'V3009A' que representa o curso mais elevado que frequentou.
table(df_pnad$V3009A)

# Salvando os dados em um arquivo CSV para garantir que podemos reutilizar os dados mais tarde
# Especificamos o caminho "Input/microdados_pnad.csv" onde o arquivo ser√° salvo
write.csv(df_pnad, "Input/microdados_pnad.csv")

# Carregando os dados salvos em CSV novamente para verificar e manipular posteriormente
# df_pnad <- read.csv("Input/microdados_pnad.csv")

# df_backup <- df_pnad
# 
# df_pnad <- df_backup


# Quest√£o 3:

# Baixadas as vari√°veis, tomem cuidado para realizar quaisquer limpezas que possam ser necess√°rias. 
# Todas as informa√ß√µes sobre valores de vari√°veis est√£o dispon√≠veis no dicion√°rio.

# Aplicando as transforma√ß√µes para limpar e preparar os dados com o pacote dplyr:
df_pnad <- df_pnad %>% mutate(
  
  # Convertendo a vari√°vel de rendimento para num√©rico  
  VAL_RENDIMENTO = as.numeric(VD4020),
  
  # Convertendo a vari√°vel de horas trabalhadas para inteiro
  NUM_HORAS = as.integer(VD4031),
  
  # Convertendo a vari√°vel de Unidade Federativa para string
  NOM_UF = as.character(UF),
  
  # Criando uma vari√°vel bin√°ria indicando se o indiv√≠duo vive em √°rea urbana
  IN_URBANA = ifelse(V1022=="Urbana", 1, 0),
  
  # Criando uma vari√°vel bin√°ria indicando o sexo (1 para feminino, 0 para masculino)
  IN_FEMININO = ifelse(V2007=="Mulher", 1, 0),
  
  # Convertendo a vari√°vel de idade para inteiro
  NUM_IDADE = as.integer(V2009),
  
  # Criando uma vari√°vel bin√°ria para identificar pessoas de cor preta ou parda
  IN_PRETA_PARDA = ifelse(V2010=="Preta"|V2010=="Parda",1,0), # & para interse√ß√£o "e" e | para uni√£o "ou"
  
  
  # Criando vari√°veis bin√°rias para n√≠vel de educa√ß√£o:
  # IN_EDUC_1: Indiv√≠duos com n√≠vel educacional b√°sico (creche at√© supletivo de 1¬∫ grau)
  IN_EDUC_1 = ifelse(V3009A == "Creche (dispon√≠vel apenas no question√°rio anual de educa√ß√£o)"|
                       V3009A == "Pr√©-escola"|
                       V3009A == "Classe de alfabetiza√ß√£o - CA"|
                       V3009A == "Alfabetiza√ß√£o de jovens e adultos"|
                       V3009A == "Antigo prim√°rio (elementar)"|
                       V3009A == "Antigo gin√°sio (m√©dio 1¬∫ ciclo)"|
                       V3009A == "Regular do ensino fundamental ou do 1¬∫ grau"|
                       V3009A == "Educa√ß√£o de jovens e adultos (EJA) ou supletivo do 1¬∫ grau",1,0),
  
  # IN_EDUC_2: Indiv√≠duos com n√≠vel educacional m√©dio (cient√≠fico at√© EJA de 2¬∫ grau)
  IN_EDUC_2 = ifelse(V3009A == "Antigo cient√≠fico, cl√°ssico, etc. (m√©dio 2¬∫ ciclo)"|
                       V3009A == "Regular do ensino m√©dio ou do 2¬∫ grau"|
                       V3009A == "Educa√ß√£o de jovens e adultos (EJA) ou supletivo do 2¬∫ grau",1,0),
  
  # IN_EDUC_3: Indiv√≠duos com n√≠vel educacional superior (gradua√ß√£o at√© doutorado)
  IN_EDUC_3 = ifelse(V3009A == "Superior - gradua√ß√£o"|
                       V3009A == "Especializa√ß√£o de n√≠vel superior"|
                       V3009A == "Mestrado"|
                       V3009A == "Doutorado",1,0),
  
  # Agrupando os tr√™s n√≠veis de educa√ß√£o em uma √∫nica vari√°vel categ√≥rica
  GRUPO_EDUC = 1*IN_EDUC_1+2*IN_EDUC_2+3*IN_EDUC_3,
  
  # Criando uma vari√°vel de anos de estudo
  NUM_ANOS_ESTUDO = as.integer(case_when(
    VD3005 == "Sem instru√ß√£o e menos de 1 ano de estudo" ~ "00",
    VD3005 == "1 ano de estudo" ~ "01",
    VD3005 == "2 anos de estudo" ~ "02",
    VD3005 == "3 anos de estudo" ~ "03",
    VD3005 == "4 anos de estudo" ~ "04",
    VD3005 == "5 anos de estudo" ~ "05",
    VD3005 == "6 anos de estudo" ~ "06",
    VD3005 == "7 anos de estudo" ~ "07",
    VD3005 == "8 anos de estudo" ~ "08",
    VD3005 == "9 anos de estudo" ~ "09",
    VD3005 == "10 anos de estudo" ~ "10",
    VD3005 == "11 anos de estudo" ~ "11",
    VD3005 == "12 anos de estudo" ~ "12",
    VD3005 == "13 anos de estudo" ~ "13",
    VD3005 == "14 anos de estudo" ~ "14",
    VD3005 == "15 anos de estudo" ~ "15",
    VD3005 == "16 anos ou mais de estudo" ~ "16"
  )),
  
  # Criando uma vari√°vel bin√°ria para a for√ßa de trabalho (1 se est√° na for√ßa de trabalho)
  IN_FORCA_TRABALHO = ifelse(VD4001=="Pessoas na for√ßa de trabalho",1,0),
  
  # Criando uma vari√°vel bin√°ria para ocupa√ß√£o (1 se est√° ocupado)
  IN_OCUPADO = ifelse(VD4002=="Pessoas ocupadas",1,0),
  
  # Criando uma vari√°vel categ√≥rica para a posi√ß√£o ocupacional
  COD_POSICAO_OCUPACAO = case_when(
    VD4009 == "Empregado no setor privado com carteira de trabalho assinada" ~ "01",
    VD4009 == "Empregado no setor privado sem carteira de trabalho assinada" ~ "02",
    VD4009 == "Trabalhador dom√©stico com carteira de trabalho assinada" ~ "03",
    VD4009 == "Trabalhador dom√©stico sem carteira de trabalho assinada" ~ "04",
    VD4009 == "Empregado no setor p√∫blico com carteira de trabalho assinada" ~ "05",
    VD4009 == "Empregado no setor p√∫blico sem carteira de trabalho assinada" ~ "06",
    VD4009 == "Militar e servidor estatut√°rio" ~ "07",
    VD4009 == "Empregador" ~ "08",
    VD4009 == "Conta-pr√≥pria" ~ "09",
    VD4009 == "Trabalhador familiar auxiliar" ~ "10")
) %>% 
  
  # Selecionando apenas as vari√°veis de interesse
  select(VAL_RENDIMENTO,
         NUM_HORAS,
         NOM_UF,
         IN_URBANA,
         IN_FEMININO,
         NUM_IDADE,
         IN_PRETA_PARDA,
         IN_EDUC_1, #incluindo as classes novas
         IN_EDUC_2,
         IN_EDUC_3,
         GRUPO_EDUC, 
         NUM_ANOS_ESTUDO,
         IN_FORCA_TRABALHO,
         IN_OCUPADO,
         COD_POSICAO_OCUPACAO) %>% 
  
  # Filtrando apenas os dados do Amap√°
  filter(NOM_UF=="Amap√°")

# Se quiser salvar como Amapa na pasta dados
# write.csv(df_pnad, "dados/microdados_pnad_amapa.csv", row.names = FALSE)


# OBS: A f√ß do pipe operator(%>%), permite que voc√™ encadeie fun√ß√µes de forma clara e leg√≠vel, passando o resultado de 
# uma fun√ß√£o diretamente como entrada para a pr√≥xima. 
# Isso evita a necessidade de criar v√°rias vari√°veis intermedi√°rias ou aninhar v√°rias fun√ß√µes dentro de outra.
# ex: resultado <- fun√ß√£o2(fun√ß√£o1(dados)) vira:
#dados %>% 
#fun√ß√£o1() %>% 
#fun√ß√£o2()




# Monitoria 03/09

# Quest√£o 4:

# (a) Filtre a base de dados, mantendo apenas a popula√ß√£o entre 20 e 60 anos. 
# (b) Calcule a propor√ß√£o de pessoas economicamente ativas, condicional ao n√≠vel de escolaridade, sexo, e idade, separadamente. 
# (c) Depois, fa√ßam o mesmo exerc√≠cio apenas para a regi√£o de voc√™s (Amap√°). DISPENSADO
# (d) Como a probabilidade de estar no mercado de trabalho varia em fun√ß√£o dessas caracter√≠sticas? 
# (e) Analisem tamb√©m as poss√≠veis causas de diferen√ßas entre o resultado nacional e o resultado espec√≠fico do grupo.DISPENSADO

# (a) Filtrando os dados para manter apenas pessoas entre 20 e 60 anos de idade 
df_pnad <- df_pnad %>% filter(NUM_IDADE>=20 & NUM_IDADE<=60)
# Outra op√ß√£o de filtro usando todas as colunas:
# df_pnad <- df_pnad[df_pnad$NUM_IDADE >= 20 & df_pnad$NUM_IDADE<=60,] 


# (b) Propor√ß√£o geral de trabalhadores economicamente ativos (na for√ßa de trabalho)
# Calcula a propor√ß√£o de pessoas na for√ßa de trabalho (IN_FORCA_TRABALHO == 1) no total  
nrow(df_pnad[df_pnad$IN_FORCA_TRABALHO==1,])/nrow(df_pnad)



# (b) Propor√ß√£o condicional ao n√≠vel de escolaridade (agrupando por n√≠vel de educa√ß√£o)
# Agrupa pelo n√≠vel de educa√ß√£o e calcula a m√©dia de pessoas na for√ßa de trabalho
tab_educ <- df_pnad %>% group_by(GRUPO_EDUC) %>% summarise(
  FRAC_EDUC = mean(IN_FORCA_TRABALHO, na.rm = T) #excluindo NA
)

# (b) Propor√ß√£o condicional ao sexo (agrupando pela vari√°vel IN_FEMININO)
# Agrupa por sexo (IN_FEMININO, onde 0 = masculino e 1 = feminino) e calcula a propor√ß√£o na for√ßa de trabalho
tab_sexo <- df_pnad %>% group_by(IN_FEMININO) %>% summarise(
  FRAC_SEXO = mean(IN_FORCA_TRABALHO, na.rm = T)
)

# (b) Propor√ß√£o condicional √† idade (entre 20 e 60 anos)
# Agrupa por idade e calcula a propor√ß√£o de pessoas na for√ßa de trabalho por idade
tab_idade <- df_pnad %>% group_by(NUM_IDADE) %>% summarise(
  FRAC_IDADE = mean(IN_FORCA_TRABALHO, na.rm = T)
)

# OBS: (d) Relat√≥rio: Agrupando por idade e sexo dentro da for√ßa de trabalho
# Usamos o pacote tidyverse (que inclui dplyr) para fazer o agrupamento por idade e sexo,
# e calcular a propor√ß√£o de cada grupo na for√ßa de trabalho.


# Agrupando por idade e sexo (IN_FEMININO), pivotando os dados para ter as colunas de fra√ß√µes
tab_sexo_idade <- df_pnad %>% group_by(NUM_IDADE, IN_FEMININO) %>% summarise(
  FRAC_SEXO_IDADE = mean(IN_FORCA_TRABALHO, na.rm = T)
) %>% pivot_wider(id_cols = "NUM_IDADE", #coluna que nao muda, coluna de identifica√ß√£o
                  names_from = "IN_FEMININO", #coluna pivotada
                  values_from = "FRAC_SEXO_IDADE",#identifica valores imputados nas obs
                  names_prefix = "SEXO_") # sexo_ 0 ou 1
#usamos o pipe nesse formato %>%

# Renomeando as colunas da tabela pivotada
colnames(tab_sexo_idade) <- c("Idade", "Fra√ß√£o Masculina", "Fra√ß√£o Feminina")


# Quest√£o 5:
# (a) Filtre os dados para manter apenas trabalhadores do setor privado, empregados na data da amostra.
# (b) Voc√™s devem reportar uma tabela com estat√≠sticas descritivas (m√≠nimo, m√°ximo, m√©dia, desvio-padr√£o e quantis)
# (c) Propor√ß√µes de cada grupo para as vari√°veis de n√≠vel (trate idade como cont√≠nua). Falta
# (d) Para realizar nossa avalia√ß√£o, √© importante que nenhuma vari√°vel tenha todas as observa√ß√µes iguais. 
#Explique qual seria o problema caso contr√°rio - Falta

# (a)

# (a) Filtrando os trabalhadores do setor privado com carteira assinada ou sem carteira assinada
# (Varivel SETOR VD4009) - 1 carteira assinada / 2 sem carteira assinada
df_pnad_setor_privado <- df_pnad %>% filter(
  COD_POSICAO_OCUPACAO %in% c("01","02")
  # COD_POSICAO_OCUPACAO=="01"|COD_POSICAO_OCUPACAO=="02" (2¬∫maneira)
)

# (b) Estat√≠sticas descritivas das vari√°veis cont√≠nuas (sal√°rio, horas trabalhadas, idade, anos de estudo)
# Utilizando a fun√ß√£o summary para gerar m√≠nimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil, m√°ximo e valores ausentes (NA)

# Estat√≠sticas descritivas do valor de rendimento (sal√°rio)
# f√ß summary, das vari√°veis cont√≠nuas
summary(df_pnad_setor_privado$VAL_RENDIMENTO) #Fotografia do resultado abaixo
#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0     998    1100    1435    1600   15000       6

# Estat√≠sticas descritivas do n√∫mero de horas trabalhadas por semana
summary(df_pnad_setor_privado$NUM_HORAS)
#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 8.00   40.00   40.00   39.76   44.00   70.00

# Estat√≠sticas descritivas da idade dos indiv√≠duos
summary(df_pnad_setor_privado$NUM_IDADE)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 20.00   26.00   32.00   34.14   41.50   60.00

# Estat√≠sticas descritivas dos anos de estudo
summary(df_pnad_setor_privado$NUM_ANOS_ESTUDO)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.00   11.00   12.00   11.76   14.00   16.00  

# (c) Frequ√™ncia das vari√°veis categ√≥ricas
# Utilizando a fun√ß√£o table para contar as ocorr√™ncias de cada n√≠vel das vari√°veis categ√≥ricas 

# Contagem da vari√°vel "IN_URBANA" (se o domic√≠lio √© urbano ou rural)
# Exemplo de sa√≠da esperada: Frequ√™ncia para 0 (rural) e 1 (urbano)
table(df_pnad_setor_privado$IN_URBANA)
# 0   1 
# 29 530

# Contagem da vari√°vel "IN_FEMININO" (g√™nero, sendo 0 = masculino e 1 = feminino)
# Exemplo de sa√≠da esperada: Frequ√™ncia para 0 (homem) e 1 (mulher)
table(df_pnad_setor_privado$IN_FEMININO)
#  0   1 
# 354 205 

# Contagem da vari√°vel "IN_PRETA_PARDA" (se a pessoa se declara preta ou parda)
# Exemplo de sa√≠da esperada: Frequ√™ncia para 0 (n√£o preta/parda) e 1 (preta/parda)
table(df_pnad_setor_privado$IN_PRETA_PARDA)
# 0   1 
# 97 462

# Contagem da vari√°vel "GRUPO_EDUC" (n√≠vel de educa√ß√£o: 1 = baixa, 2 = m√©dia, 3 = alta)
# Exemplo de sa√≠da esperada: Frequ√™ncia para 1 (baixa), 2 (m√©dia), 3 (alta)
table(df_pnad_setor_privado$GRUPO_EDUC)
#   1    2    3 
#  98 261 130 

# Contagem da vari√°vel "COD_POSICAO_OCUPACAO" (posi√ß√£o de ocupa√ß√£o: 01 = carteira assinada, 02 = sem carteira assinada)
# Exemplo de sa√≠da esperada: Frequ√™ncia para 01 (com carteira) e 02 (sem carteira)
table(df_pnad_setor_privado$COD_POSICAO_OCUPACAO)
# 01   02 
# 382 177 

# (d) Explica√ß√£o sobre o problema de vari√°veis com observa√ß√µes iguais:
# Se uma vari√°vel tem todas as observa√ß√µes iguais, ela n√£o contribui para o modelo de regress√£o.
# Isso ocorre porque uma vari√°vel constante n√£o tem variabilidade e, portanto, n√£o pode explicar a 
# varia√ß√£o na vari√°vel dependente (rendimento, por exemplo).



# Monitoria 04/09

# Quest√£o 6:
# (a) Calcule o sal√°rio de cada indiv√≠duo e gere os histogramas dos sal√°rios condicionais ao seu n√≠vel mais elevado de educa√ß√£o. 
# (b) Fa√ßa o mesmo com o logaritmo dos sal√°rios. Qual conjunto de histogramas mais se assemelha com uma distribui√ß√£o normal? 
# (c) Comente a rela√ß√£o desses histogramas com o que sabemos sobre a distribui√ß√£o condicional de ùë¶ dadas todas as hip√≥teses de MQO.
# A distribui√ß√£o √© aproximadamente Normal portanto podemos usar MQO.
# (a)

# Removendo observa√ß√µes com valores NA para o n√≠vel de educa√ß√£o
df_plot <- df_pnad_setor_privado[!is.na(df_pnad_setor_privado$GRUPO_EDUC),]

# Calculando o quantil de 95% do sal√°rio para eliminar outliers
quantile(df_plot$VAL_RENDIMENTO, 0.95, na.rm = T) # 3000

# Filtrando os dados para manter apenas indiv√≠duos com sal√°rios menores ou iguais ao 95¬∫ percentil
df_plot <- df_plot[df_plot$VAL_RENDIMENTO<=quantile(df_plot$VAL_RENDIMENTO, 0.95, na.rm = T),]

# Gerando o histograma dos sal√°rios condicionados ao n√≠vel mais elevado de educa√ß√£o
hist_plot <- ggplot(data = df_plot,
                    aes(x = VAL_RENDIMENTO,
                        fill = as.factor(GRUPO_EDUC))) +
  geom_histogram(alpha = 0.7, binwidth = 250, position=position_identity()) +
  labs(x = "Valor de Rendimento",
       y = "Observa√ß√µes",
       title = "Histograma de Valor de Rendimento \npor N√≠vel de Educa√ß√£o") +
  scale_fill_manual(
    name = "Grupo de Educa√ß√£o",
    values = c("1" = "blue", "2" = "yellow", "3" = "red"),
    breaks = c("1","2","3"),
    labels = c("Baixa", "M√©dia", "Alta")
  ) + theme_minimal()

# Exibindo o histograma
hist_plot


# (b)

# Gerando o histograma do logaritmo dos sal√°rios condicionados ao n√≠vel mais elevado de educa√ß√£o
hist_plot_log <- ggplot(data = df_plot,
                        aes(x = log(VAL_RENDIMENTO),
                            fill = as.factor(GRUPO_EDUC))) +
  geom_histogram(alpha = 0.7, position=position_identity()) +
  labs(x = "Valor de Rendimento",
       y = "Observa√ß√µes",
       title = "Histograma Log de Valor de Rendimento \npor N√≠vel de Educa√ß√£o") +
  scale_fill_manual(
    name = "Grupo de Educa√ß√£o",
    values = c("1" = "blue", "2" = "yellow", "3" = "red"),
    breaks = c("1","2","3"),
    labels = c("Baixa", "M√©dia", "Alta")
  ) + theme_minimal()

# Exibindo o histograma
hist_plot_log


# y = alpha + beta X + epsilon


# Interpreta√ß√£o dos coeficientes:
# d VAL_RENDIMENTO/ d NUM_ANOS_ESTUDO (Homens) = beta_1
# d VAL_RENDIMENTO/ d NUM_ANOS_ESTUDO (Mulheres) = beta_1 + beta_3
# Gender Gap Educacional = d VAL_RENDIMENTO/ d NUM_ANOS_ESTUDO (Homens) -  d VAL_RENDIMENTO/ d NUM_ANOS_ESTUDO (Mulheres) = - beta_3



# Quest√£o 7:
# Fa√ßa uma regress√£o simples do logaritmo dos sal√°rios sobre anos de escolaridade e reporte o resultado,comentando os testes de hip√≥tese usuais. 
# Se estiver usando o R, o pacote stargazer pode ser √∫til para a gera√ß√£o de tabelas.- usa LaTex

# Estimando uma regress√£o linear para o rendimento, considerando anos de estudo e sexo
reg_1 <- lm(VAL_RENDIMENTO ~ 1 + NUM_ANOS_ESTUDO + IN_FEMININO + NUM_ANOS_ESTUDO*IN_FEMININO, data = df_pnad_setor_privado)

# Regress√£o simples: logaritmo dos sal√°rios sobre anos de escolaridade
# Log coloca 1+,1 ano a mais de estudo, como impacta; log percentual de rendimento
reg_2 <- lm(log(1+VAL_RENDIMENTO) ~ NUM_ANOS_ESTUDO, data = df_pnad_setor_privado)

# Visualizando os resultados
summary(reg_1)
summary(reg_2)



# Quest√£o 8:
# Fa√ßa duas regress√µes simples, de anos de escolaridade sobre sexo e ra√ßa, respectivamente. 
# O que os resultados dessa regress√£o nos dizem sobre a validade da regress√£o feita no item anterior? 
# Analise o poss√≠vel vi√©s que pode existir, se baseando na teoria de MQO, e a dire√ß√£o desse vi√©s.

# Regress√£o de anos de escolaridade sobre ra√ßa - Preconceito racial
reg_3 <- lm(NUM_ANOS_ESTUDO ~ IN_PRETA_PARDA, data = df_pnad_setor_privado)
summary(reg_3)

# Regress√£o de anos de escolaridade sobre g√™nero (sexo)
reg_4 <- lm(NUM_ANOS_ESTUDO ~ IN_FEMININO, data = df_pnad_setor_privado)
summary(reg_4)
# Em media mulheres estudam xxx mais que Homem


# Quest√£o 9: Regress√µes separadas por g√™nero (homens e mulheres), verificando os coeficientes.
# Fa√ßa duas regress√µes, de logaritmo dos sal√°rios sobre anos de educa√ß√£o, sendo uma apenas com mulheres e outra apenas com homens. 
# Os coeficientes estimados s√£o os mesmos? O que isso nos diz sobre o que precisamos incluir na regress√£o completa? 
# Al√©m do modelo, voc√™s devem gerar um gr√°fico com os pontos da amostra (ou uma subamostra deles, se o c√≥digo ficar lento), e as duas retas de regress√£o.


# Criando subsets para homens e mulheres
df_pnad_homens <- df_pnad_setor_privado[df_pnad_setor_privado$IN_FEMININO==0,]
df_pnad_mulheres <- df_pnad_setor_privado[df_pnad_setor_privado$IN_FEMININO==1,]

# Regress√µes para homens e mulheres (logaritmo dos sal√°rios)
reg_5.homens <- lm(VAL_RENDIMENTO ~ NUM_ANOS_ESTUDO, data = df_pnad_homens)
reg_6.homens <- lm(log(1+VAL_RENDIMENTO) ~ NUM_ANOS_ESTUDO, data = df_pnad_homens)

# Visualizando
summary(reg_5.homens)
summary(reg_6.homens)


reg_5.mulheres <- lm(VAL_RENDIMENTO ~ NUM_ANOS_ESTUDO, data = df_pnad_mulheres)
reg_6.mulheres <- lm(log(1+VAL_RENDIMENTO) ~ NUM_ANOS_ESTUDO, data = df_pnad_mulheres)

summary(reg_5.mulheres)
summary(reg_6.mulheres)

# Criando gr√°fico para visualizar a regress√£o de log do sal√°rio por anos de estudo, separado por g√™nero
plot_2 <- ggplot(data = df_pnad_setor_privado, 
                 aes(x = NUM_ANOS_ESTUDO, y = log(1+VAL_RENDIMENTO), color = as.factor(IN_FEMININO))) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_manual(name = "G√™nero",
                     values = c("0" = "blue", "1" = "red"),
                     labels = c("Homem", "Mulher")) +
  labs(
    title = "Log do Valor de Rendimentos por \nAnos de Estudo",
    x = "Anos de Estudo",
    y = "Log do Valor de Rendimentos"
  )

# Exibindo o gr√°fico
plot_2

# Quest√£o 10: Gr√°fico de regress√£o por g√™nero.

# Com base na sua conclus√£o do item anterior, fa√ßam uma regress√£o para explicar o logaritmo dos sal√°rios,incluindo todas as vari√°veis vistas at√© aqui, 
# e interpretem os valores dos coeficientes estimados, assim como a signific√¢ncia deles e de quaisquer intera√ß√µes inclu√≠das. 
# Qual √© o valor marginal de um ano adicional de escolaridade para um homem? E para uma mulher? Eles s√£o estatisticamente iguais?
# Tem que ver o pvalue pra responder

# Regress√£o completa para explicar o logaritmo dos sal√°rios incluindo anos de estudo e intera√ß√£o com o g√™nero
reg_7 <- lm(log(1 + VAL_RENDIMENTO) ~ IN_FEMININO + NUM_ANOS_ESTUDO + IN_FEMININO:NUM_ANOS_ESTUDO, data = df_pnad_setor_privado)

# Visualizando o resumo da regress√£o para verificar a signific√¢ncia e interpreta√ß√£o dos coeficientes
summary(reg_7)


# Interpreta√ß√£o dos coeficientes:
# O intercepto (Intercept) √© o valor do logaritmo do sal√°rio quando IN_FEMININO = 0 (ou seja, homens) e NUM_ANOS_ESTUDO = 0.
# O coeficiente para NUM_ANOS_ESTUDO representa o efeito marginal de um ano adicional de estudo para homens (IN_FEMININO = 0).
# O coeficiente para IN_FEMININO mostra a diferen√ßa no logaritmo do sal√°rio entre mulheres e homens, quando o n√∫mero de anos de estudo √© zero.
# O coeficiente da intera√ß√£o IN_FEMININO:NUM_ANOS_ESTUDO mostra a diferen√ßa no efeito dos anos de estudo sobre o logaritmo do sal√°rio entre homens e mulheres.




# Quest√£o 11:Incorporando efeito quadr√°tico de experi√™ncia.

# √â poss√≠vel que o n√≠vel de experi√™ncia tenha efeito importante sobre os sal√°rios,por√©m h√° d√∫vidas sobre como deve ser a forma funcional desse efeito. 
# Como poder√≠amos incorporar efeitos n√£o-lineares no modelo? 
# Supondo que o efeito seja quadr√°tico, qual seria o n√≠vel de experi√™ncia que maximiza o sal√°rio, tudo mais constante?

# Criando uma vari√°vel quadr√°tica para idade (proxy de experi√™ncia)
df_pnad_setor_privado$NUM_IDADE_QUADRADO <- df_pnad_setor_privado$NUM_IDADE**2

# Regress√£o com o efeito quadr√°tico da idade e intera√ß√£o com anos de estudo e g√™nero
reg_8 <- lm(log(1+VAL_RENDIMENTO) ~ IN_FEMININO*NUM_ANOS_ESTUDO + NUM_IDADE + NUM_IDADE_QUADRADO, data = df_pnad_setor_privado)
summary(reg_8)


# Calculando o ponto de m√°ximo da idade, onde o sal√°rio √© maximizado
b1 <- reg_8$coefficients["NUM_IDADE"]
b2 <- reg_8$coefficients["NUM_IDADE_QUADRADO"]
idade_otima <- -b1 / (2 * b2)

# Exibindo a idade √≥tima (m√°ximo da fun√ß√£o quadr√°tica)
idade_otima

# Criando uma nova vari√°vel para o rendimento por hora
df_pnad_setor_privado <- df_pnad_setor_privado %>% mutate(
  VAL_RENDIMENTO_HORA = VAL_RENDIMENTO/(NUM_HORAS*4)
)

df_pnad_setor_privado <- df_pnad_setor_privado %>% mutate(
  VAL_RENDIMENTO_HORA = VAL_RENDIMENTO / (NUM_HORAS * 4) # Calcular o rendimento por hora
)


# Verificando se a vari√°vel foi criada corretamente
head(df_pnad_setor_privado$VAL_RENDIMENTO_HORA)

# Regress√£o adicional para explicar o log do rendimento por hora, incluindo vari√°veis adicionais
reg_9 <- lm(log(1+VAL_RENDIMENTO_HORA)~
              IN_URBANA + 
              IN_FEMININO*NUM_ANOS_ESTUDO +
              IN_PRETA_PARDA*NUM_ANOS_ESTUDO+
              NUM_IDADE +
              NUM_IDADE_QUADRADO +
              as.factor(COD_POSICAO_OCUPACAO), data = df_pnad_setor_privado
)

# Visualizando o resumo da regress√£o com o efeito quadr√°tico e intera√ß√µes
summary(reg_9)




      ## Etapas do Trabalho

  Q1:
   Primeiramente, voc√™s devem acessar os dados da PNAD referente √† cross-section do seu grupo. Isso pode ser feito diretamente pelo site, ou atrav√©s do pacote `pnadcibge` no R. Em todos os casos, utilizem os dados referentes ao terceiro trimestre da amostra.

  Q2:
  A PNAD possui uma quantidade enorme de dados, por√©m iremos utilizar apenas algumas vari√°veis tradicionais da literatura. Como o dataset guarda os dados atrav√©s de seus c√≥digos, voc√™s precisam consultar o dicion√°rio da PNAD (dispon√≠vel no site) e selecionar as colunas com os c√≥digos corretos. As vari√°veis s√£o:

    - Rendimento mensal efetivo de todos os trabalhos para pessoas de 14 anos ou mais de idade;
    - Horas habitualmente trabalhadas em todos os trabalhos para pessoas de 14 anos ou mais;
    - Unidade da Federa√ß√£o;
    - Rural/Urbano;
    - Sexo;
    - Idade do morador na data de refer√™ncia;
    - Cor ou ra√ßa;
    - Curso mais elevado que frequentou anteriormente?;
    - Anos de estudo;
    - Condi√ß√£o em rela√ß√£o √† for√ßa de trabalho na semana de refer√™ncia para pessoas de 14 anos ou mais de idade;
    - Condi√ß√£o de ocupa√ß√£o na semana de refer√™ncia para pessoas de 14 anos ou mais de idade;
    - Setor do trabalho.

Q3:
Baixadas as vari√°veis, tomem cuidado para realizar quaisquer limpezas que possam ser necess√°rias. Todas as informa√ß√µes sobre valores de vari√°veis est√£o dispon√≠veis no dicion√°rio.

Q4:
Filtre a base de dados, mantendo apenas a popula√ß√£o entre 20 e 60 anos. Calcule a propor√ß√£o de pessoas economicamente ativas, condicional ao n√≠vel de escolaridade, sexo, e idade, separadamente. Depois, fa√ßam o mesmo exerc√≠cio apenas para a regi√£o de voc√™s (Amap√°). Como a probabilidade de estar no mercado de trabalho varia em fun√ß√£o dessas caracter√≠sticas? Analisem tamb√©m as poss√≠veis causas de diferen√ßas entre o resultado nacional e o resultado espec√≠fico do grupo.

Q5:
Ap√≥s gerar a base tratada, filtre os dados para manter apenas trabalhadores do setor privado, empregados na data da amostra. Voc√™s devem reportar uma tabela com estat√≠sticas descritivas (m√≠nimo, m√°ximo, m√©dia, desvio-padr√£o e quantis) das vari√°veis cont√≠nuas, e as propor√ß√µes de cada grupo para as vari√°veis de n√≠vel (trate idade como cont√≠nua). Para realizar nossa avalia√ß√£o, √© importante que nenhuma vari√°vel tenha todas as observa√ß√µes iguais. Explique qual seria o problema caso contr√°rio

Q6:
Calcule o sal√°rio de cada indiv√≠duo e gere os histogramas dos sal√°rios condicionais ao seu n√≠vel mais elevado de educa√ß√£o. Fa√ßa o mesmo com o logaritmo dos sal√°rios. Qual conjunto de histogramas mais se assemelha com uma distribui√ß√£o normal? Comente a rela√ß√£o desses histogramas com o que sabemos sobre a distribui√ß√£o condicional de ùë¶ dadas todas as hip√≥teses de MQO.

Q7:
Fa√ßa uma regress√£o simples do logaritmo dos sal√°rios sobre anos de escolaridade e reporte o resultado, comentando os testes de hip√≥tese usuais. Se estiver usando o R, o pacote stargazer pode ser √∫til para a gera√ß√£o de tabelas.

Q8:
Fa√ßa duas regress√µes simples, de anos de escolaridade sobre sexo e ra√ßa, respectivamente. O que os resultados dessa regress√£o nos dizem sobre a validade da regress√£o feita no item anterior? Analise o poss√≠vel vi√©s que pode existir, se baseando na teoria de MQO, e a dire√ß√£o desse vi√©s.

Q9:
Fa√ßa duas regress√µes, de logaritmo dos sal√°rios sobre anos de educa√ß√£o, sendo uma apenas com mulheres e outra apenas com homens. Os coeficientes estimados s√£o os mesmos? O que isso nos diz sobre o que precisamos incluir na regress√£o completa? Al√©m do modelo, voc√™s devem gerar um gr√°fico com os pontos da amostra (ou uma subamostra deles, se o c√≥digo ficar lento), e as duas retas de regress√£o.

Q10:
Com base na sua conclus√£o do item anterior, fa√ßam uma regress√£o para explicar o logaritmo dos sal√°rios, incluindo todas as vari√°veis vistas at√© aqui, e interpretem os valores dos coeficientes estimados, assim como a signific√¢ncia deles e de quaisquer intera√ß√µes inclu√≠das. Qual √© o valor marginal de um ano adicional de escolaridade para um homem? E para uma mulher? Eles s√£o estatisticamente iguais?

Q11:
√â poss√≠vel que o n√≠vel de experi√™ncia tenha efeito importante sobre os sal√°rios, por√©m h√° d√∫vidas sobre como deve ser a forma funcional desse efeito. Como poder√≠amos incorporar efeitos n√£o-lineares no modelo? Supondo que o efeito seja quadr√°tico, qual seria o n√≠vel de experi√™ncia que maximiza o sal√°rio, tudo mais constante?

Q12 (B√¥nus):
Para finalizar, comentem como os resultados podem se relacionar com as probabilidades de estar no mercado de trabalho calculadas no come√ßo do trabalho. A an√°lise feita aqui √© apenas sobre sal√°rios reais, ou seja, pode existir um vi√©s de sele√ß√£o sobre a amostra de sal√°rios, dado que as pessoas decidem trabalhar em fun√ß√£o de suas caracter√≠sticas pessoais, que s√£o tamb√©m as vari√°veis que usamos na regress√£o. Isso pode ser interpretado como considerar o sal√°rio de reserva de um indiv√≠duo uma fun√ß√£o de suas caracter√≠sticas. Como voc√™s esperariam que o sal√°rio de reserva varie com idade, sexo e escolaridade? Como essa varia√ß√£o pode gerar vi√©s no modelo? Este item √© inteiramente opcional.